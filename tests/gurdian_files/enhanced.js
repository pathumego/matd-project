define("common/modules/analytics/foresee-survey",["common/utils/config","common/utils/cookies","common/utils/detect"],function(e,t,n){function o(){require(["js!foresee.js"])}function i(){var i="Network Front"===e.page.contentType,s=n.isBreakpoint({max:"mobile"})?.008:.006,a=Math.random()<=s,r=/forceForesee/.test(location.hash);t.get("GU_TEST")||i||!(window.openForeseeWhenReady||a||r)||o(),window.guardian&&(window.guardian.openForesee=o)}return{load:i}}),define("common/modules/analytics/livestats",["common/utils/cookies","common/utils/storage","common/modules/analytics/beacon","common/modules/experiments/ab"],function(e,t,n,o){function i(){var e="gu.session";return"undefined"!=typeof a?a:(t.session.get(e)?a=!1:(t.session.set(e,"true"),a=!0),a)}function s(e,t){var n,o=[];for(n in e)o.push(n+"="+encodeURIComponent(e[n]));return t+"?"+o.join("&")}var a;return{log:function(){var e=o.getAbLoggableObject();i()?e.type="session":e.type="view",n.fire(s(e,"/ab.gif"))}}}),define("common/modules/analytics/media-listener",["bean","common/utils/mediator"],function(e,t){return function(){if(window.matchMedia){var e=window.matchMedia("print");e.addListener(function(){e.matches&&t.emit("module:clickstream:interaction","print")})}}}),define("lodash/collections/where",["./filter"],function(e){var t=e;return t}),define("common/modules/analytics/register",["common/utils/mediator","common/modules/experiments/ab","lodash/collections/where"],function(e,t,n){function o(e){c.push({name:e,status:"unfinished"})}function i(e){n(c,{name:e}).forEach(function(e){e.status="completed",e.endTime=Date.now()-l+"ms"})}function s(e){n(c,{name:e}).forEach(function(e){e.status="failed",e.endTime=Date.now()-l+"ms"})}function a(){require(["ophan/ng"],function(e){e.record({register:c,abTestRegister:t.getAbLoggableObject()})})}function r(){e.on("register:begin",o),e.on("register:end",i),e.on("register:error",s),window.setTimeout(a.bind(),5e3)}var c=[],l=Date.now();return{initialise:r,begin:o,end:i,error:s}}),define("common/modules/analytics/scrollDepth",["common/utils/mediator","lodash/objects/assign","lodash/functions/bindAll","lodash/functions/debounce"],function(e,t,n,o){function i(e){this.opts=t(this.opts,e),n(this,"assertScrolling","hasDataChanged"),this.opts.isContent&&(this.opts.contentEl=this.contentEl||document.getElementById("article")||document.getElementById("live-blog")),this.init()}return i.prototype.opts={changeThreshold:10,isContent:!1,pageEl:document.body},i.prototype.data={page:{start:(new Date).getTime(),depth:0,duration:0},content:{depth:0}},i.prototype.timeSince=function(e){return(new Date).getTime()-e},i.prototype.getPercentageInViewPort=function(e){var t=e.getBoundingClientRect(),n=window.innerHeight||document.body.clientHeight;return t.bottom<0||t.bottom<n?100:t.top>n?0:t.top>0?100/(t.height||1)*(n-t.top):100/(t.height||1)*(Math.abs(t.top)+n)},i.prototype.isInViewport=function(e){var t=e.getBoundingClientRect();return t.top<(window.innerHeight||document.body.clientHeight)&&t.left<(window.innerWidth||document.body.clientWidth)},i.prototype.setData=function(e){var t,n=this.opts[e+"El"];return n?(t=this.getPercentageInViewPort(n),t-this.data[e].depth>this.opts.changeThreshold?(this.data[e].depth=t,"number"==typeof this.data[e].duration&&(this.data[e].duration=this.timeSince(this.data[e].start)),!0):!1):!1},i.prototype.hasDataChanged=function(){var e=this.setData("page"),t=this.opts.isContent?this.setData("content"):!1;(e||t)&&this.log()},i.prototype.assertScrolling=function(){function t(){e.emit("scrolldepth:inactive")}"number"==typeof this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(t.bind(this),1e3)},i.prototype.log=function(){e.emit("scrolldepth:data",this.data)},i.prototype.init=function(){e.on("window:throttledScroll",o(this.assertScrolling,200)),e.on("scrolldepth:inactive",this.hasDataChanged),e.on("module:clickstream:click",this.hasDataChanged)},i}),define("common/utils/scan",["lodash/collections/reduce","lodash/arrays/last"],function(e,t){return function(n,o,i){return e(n,function(e,n){return e.concat(o(t(e),n))},[i])}}),define("lodash/internals/baseRandom",[],function(){function e(e,o){return e+t(n()*(o-e+1))}var t=Math.floor,n=Math.random;return e}),define("lodash/utilities/random",["../internals/baseRandom"],function(e){function t(t,i,s){var a=null==t,r=null==i;if(null==s&&("boolean"==typeof t&&r?(s=t,t=1):r||"boolean"!=typeof i||(s=i,r=!0)),a&&r&&(i=1),t=+t||0,r?(i=t,t=0):i=+i||0,s||t%1||i%1){var c=o();return n(t+c*(i-t+parseFloat("1e-"+((c+"").length-1))),i)}return e(t,i)}var n=Math.min,o=Math.random;return t}),define("common/modules/analytics/css-logging",["Promise","common/utils/config","common/utils/ajax","common/utils/detect","common/utils/url","common/utils/scan","common/utils/mediator","common/modules/analytics/beacon","lodash/objects/values","lodash/collections/sortBy","lodash/utilities/random","lodash/objects/isUndefined","lodash/functions/debounce","lodash/collections/map","lodash/arrays/uniq","lodash/arrays/compact","lodash/arrays/flatten","common/utils/chain","lodash/collections/filter","lodash/collections/forEach","lodash/collections/reduce"],function(e,t,n,o,i,s,a,r,c,l,d,u,m,h,p,g,f,v,b,w,y){function k(e){var t=e?e.cssRules||e.rules:null;return t?c(t):e}function _(e){return e&&e.selectorText&&e.selectorText.replace(L,"").split(D)}function S(e){var t=e.match(/\.[^\s\.]+\.[^\s]+/g)||[];return t.forEach(function(t){e=e.replace(t,C(t))}),e.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")}function C(e){return l(e.split(".")).join(".")}function T(e){var t,n,o=v(A()).and(h,k).and(f).and(h,k).and(f).and(h,_).and(f).and(g).and(p).and(h,S).value();return e?o:(n=o.length,t=d(0,n),o.slice(t,t+N).concat(n>t+N?[]:o.slice(0,(t+N)%n)))}function A(){return v(document.styleSheets).and(b,function(e){return e&&c(e.rules||e.cssRules).length>0&&e.ownerNode&&"STYLE"===e.ownerNode.nodeName&&e.ownerNode.className.indexOf(B)>-1}).value()}function I(e){return n({url:e.href,crossOrigin:!0}).then(function(e){var t=document.createElement("style");t.className=B,t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)})}function x(){return e.all(v(document.styleSheets).and(b,function(e){return e&&e.href&&e.href.match(/\/\/(localhost|assets\.guim\.co\.uk)/)&&(!e.media||"print"!==e.media.mediaText)&&-1===e.ownerNode.className.indexOf($)}).and(w,function(e){e.ownerNode.className+=" "+$}).and(h,I).value())}function M(e){x().then(function(){r.postJson("/css",JSON.stringify({selectors:v(T(e)).and(y,function(e,t){return u(e[t])&&(e[t]=!!document.querySelector(t)),e},{}).value(),contentType:t.page.contentType||"unknown",breakpoint:o.getBreakpoint()||"unknown"}),e)})}function j(e){return m(function(t){(!t||t.samePage)&&setTimeout(function(){M(e)},e?0:d(0,3e3))},500)}var N=500,L=new RegExp(/:+[^\s\,]+/g),D=new RegExp(/\s*,\s*/g),B="js-loggable",$="js-inlined",E=!1;return function(e){var t;e=e||"#csslogging"===window.location.hash,(e||1===d(1,2500))&&(t=j(e),t(),E||(a.on("module:clickstream:interaction",t),a.on("module:clickstream:click",t),E=!0))}}),define("common/utils/filterPairs",["lodash/collections/map","lodash/collections/filter","common/utils/chain"],function(e,t,n){return function(o){return n(o).and(t,function(e){return e[1]}).and(e,function(e){return e[0]}).value()}}),define("common/modules/analytics/simple-metrics",["common/utils/filterPairs","common/utils/mediator","common/modules/analytics/beacon"],function(e,t,n){return function(){navigator.sendBeacon&&(n.beaconCounts("sm-page-view"),t.on("module:clickstream:click",function(t){var o=e([["sm-interaction-on-same-page",t.samePage],["sm-another-guardian-page",!t.samePage&&t.sameHost],["sm-clicked-related-content",/related-content/.test(t.tag)],["sm-clicked-series-component",/\| series \|/.test(t.tag)],["sm-clicked-most-popular-component",/\| most popular \|/.test(t.tag)]]);o.length>0&&n.beaconCounts(o)}))}}),define("common/modules/commercial/adblock-messages",["common/utils/config","common/utils/detect","common/utils/storage","common/modules/commercial/user-features"],function(e,t,n,o){function i(){return t.adblockInUse()}function s(){return"mobile"!==t.getBreakpoint()}function a(){return o.isPayingMember()}function r(){var e=n.local.get("gu.alreadyVisited")||0;return e>1}function c(){return e.switches.adblock}function l(){return i()&&s()&&(!r()||!c()||c()&&r()&&a())}function d(){return c()&&i()&&!a()&&r()&&s()}return{noAdblockMsg:l,showAdblockMsg:d}}),define("text!common/views/commercial/adblock-sticky-message.html",[],function(){return'<div class="adblock-sticky__message js-adblock-sticky <%=customCssClass%>" data-link-name="adblock sticky message" role="dialog" aria-label="welcome adblock user" aria-describedby="adblock-sticky__message">\n    <div class="gs-container">\n        <div class="adblock-sticky__quote">\n            <div class="adblock-sticky__info">\n                <p class="adblock-sticky__quote-text">\n                    <%=quoteText%>\n                </p>\n                <p class="adblock-sticky__author">\n                    <%=quoteAuthor%>\n                </p>\n            </div>\n            <div class="byline-img adblock-byline-img">\n                <img class="byline-img__img" src="<%=imageAuthor%>" alt="<%=quoteAuthor%>">\n            </div>\n            <div class="adblock-sticky__logo">\n                <%=marque54icon%>\n            </div>\n        </div>\n        <div class="adblock-sticky__membership-bar">\n            <p class="adblock-sticky__membership-bar-text">\n                <%=messageText%>\n            </p>\n            <ul class="site-message__actions u-unstyled">\n                <li class="site-message__actions__sticky-item">\n                    <%=cursor%>\n                    <a href="<%=supporterLink%>" target="_blank" data-link-name="read more <%=quoteAuthor%>"><%=linkText%></a>\n                </li>\n            </ul>\n        </div>\n    </div>\n    <a class="adblock-sticky__link" href="<%=supporterLink%>" target="_blank" data-link-name="read more <%=quoteAuthor%>"></a>\n</div>\n'}),define("common/modules/adblock-banner",["fastdom","common/utils/$","common/utils/template","common/views/svgs","text!common/views/commercial/adblock-sticky-message.html"],function(e,t,n,o,i){var s=function(e){var t=e||{};this.supporterLink=t.supporterLink||"",this.messageText=t.messageText||"",this.linkText=t.linkText||"",this.quoteText=t.quoteText||"",this.quoteAuthor=t.quoteAuthor||"",this.imageAuthor=t.imageAuthor||"",this.customCssClass=t.customCssClass||""};return s.prototype.show=function(){var s=n(i,{supporterLink:this.supporterLink,quoteText:this.quoteText,quoteAuthor:this.quoteAuthor,messageText:"Become a supporter from just £5 per month to ensure quality journalism is available to all.",linkText:"Find out more",imageAuthor:this.imageAuthor,customCssClass:this.customCssClass,cursor:o("cursor"),marque54icon:o("marque54icon")});e.write(function(){t(".top-banner-ad-container--desktop").after(s)})},s}),define("common/modules/ui/message",["common/utils/$","bean","common/utils/storage","common/modules/user-prefs","common/utils/mediator","common/utils/detect","lodash/functions/debounce","lodash/arrays/uniq"],function(e,t,n,o,i,s,a,r){var c=function(t,n){var o=n||{};this.id=t,this.important=o.important||!1,this.permanent=o.permanent||!1,this.type=o.type||"banner",this.pinOnHide=o.pinOnHide||!1,this.siteMessageLinkName=o.siteMessageLinkName||"",this.siteMessageCloseBtn=o.siteMessageCloseBtn||"",this.prefs="messages",this.widthBasedMessage=o.widthBasedMessage||!1,this.$footerMessage=e(".js-footer-message")};return c.prototype.show=function(n){var o=e(".js-site-message");return this.pinOnHide&&e(".js-footer-site-message-copy").html(n),!o.hasClass("is-hidden")&&!this.important||this.hasSeen()?(this.pinOnHide&&this.$footerMessage.removeClass("is-hidden"),!1):(e(".js-site-message-copy").html(n),this.$siteMessage=e(".js-site-message__message"),this.updateMessageOnWidth(),i.on("window:resize",a(this.updateMessageOnWidth,200).bind(this)),this.siteMessageLinkName&&o.attr("data-link-name",this.siteMessageLinkName),this.siteMessageCloseBtn&&e(".site-message__close-btn",".js-site-message").attr("data-link-name",this.siteMessageCloseBtn),o.addClass("site-message--"+this.type).addClass("site-message--"+this.id),o.removeClass("is-hidden"),this.permanent?(o.addClass("site-message--permanent"),e(".site-message__close").addClass("is-hidden")):t.on(document,"click",".js-site-message-close",this.acknowledge.bind(this)),"modal"===this.type&&this.bindModalListeners(),!0)},c.prototype.bindModalListeners=function(){t.on(document,"click",".js-site-message-inner",function(e){e.stopImmediatePropagation(),e.stopPropagation()}),t.on(document,"click",".js-site-message",this.acknowledge.bind(this))},c.prototype.hide=function(){e("#header").removeClass("js-site-message"),e(".js-site-message").addClass("is-hidden"),this.pinOnHide&&this.$footerMessage.removeClass("is-hidden")},c.prototype.hasSeen=function(){var e=o.get(this.prefs);return e&&e.indexOf(this.id)>-1},c.prototype.remember=function(){var e=o.get(this.prefs)||[];e.push(this.id),o.set(this.prefs,r(e))},c.prototype.acknowledge=function(){this.remember(),this.hide()},c.prototype.updateMessageOnWidth=function(){var e="site-message-narrow",t="site-message-wide";this.widthBasedMessage&&this.$siteMessage.length&&this.updateMessageFromData(s.isBreakpoint({max:"tablet"})?e:t)},c.prototype.updateMessageFromData=function(e){var t=this.$siteMessage.data(e);t&&this.$siteMessage.text(t)},c}),define("common/modules/navigation/navigation",["bean","qwery","fastdom","common/utils/mediator","common/utils/detect","common/utils/$"],function(e,t,n,o,i,s){var a={init:function(){this.jsEnableFooterNav(),this.copyMegaNavMenu(),this.enableMegaNavToggle(),this.replaceAllSectionsLink(),i.isIOS()&&i.getUserAgent.version>5&&n.write(function(){s(".navigation__scroll").css({"-webkit-overflow-scrolling":"touch"})})},jsEnableFooterNav:function(){n.write(function(){s(".navigation-container--default").removeClass("navigation-container--default").addClass("navigation-container--collapsed")})},copyMegaNavMenu:function(){var e=s.create(s(".js-mega-nav").html()),t=s(".js-mega-nav-placeholder");n.write(function(){s(".global-navigation",e).addClass("global-navigation--top"),t.append(e)})},replaceAllSectionsLink:function(){s(".js-navigation-header .js-navigation-toggle").attr("href","#nav-allsections")},enableMegaNavToggle:function(){e.on(document,"click",".js-navigation-toggle",function(e){var t=s("."+e.currentTarget.getAttribute("data-target-nav"));e.preventDefault(),n.write(function(){t.toggleClass("navigation-container--expanded navigation-container--collapsed"),o.emit(t.hasClass("navigation-container--expanded")?"modules:nav:open":"modules:nav:close")})})}};return a}),define("text!common/views/membership-message.html",[],function(){return'<p class="site-message__message" id="site-message__message">\n    <%=messageText%>\n</p>\n<ul class="site-message__actions u-unstyled">\n    <li class="site-message__actions__item">\n        <%=arrowWhiteRight%>\n        <a href="<%=linkHref%>" target="_blank" data-link-name="read more"><%=linkText%></a>\n    </li>\n</ul>\n'}),define("lodash/collections/shuffle",["../internals/baseRandom","./forEach"],function(e,t){function n(n){var o=-1,i=n?n.length:0,s=Array("number"==typeof i?i:0);return t(n,function(t){var n=e(0,++o);s[o]=s[n],s[n]=t}),s}return n}),define("lodash/collections/sample",["../internals/baseRandom","../objects/isString","./shuffle","../support","../objects/values"],function(e,t,n,o,i){function s(s,l,d){if(s&&"number"!=typeof s.length?s=i(s):o.unindexedChars&&t(s)&&(s=s.split("")),null==l||d)return s?s[e(0,s.length-1)]:a;var u=n(s);return u.length=c(r(0,l),u.length),u}var a,r=Math.max,c=Math.min;return s}),define("common/modules/commercial/donot-use-adblock",["common/utils/$","common/utils/config","common/utils/detect","common/utils/storage","common/utils/template","common/modules/commercial/adblock-messages","common/modules/adblock-banner","common/modules/ui/message","common/modules/experiments/ab","common/modules/navigation/navigation","text!common/views/membership-message.html","common/views/svgs","lodash/collections/sample","lodash/utilities/random"],function(e,t,n,o,i,s,a,r,c,l,d,u,m,h){function p(){var e="https://membership.theguardian.com/supporter",t=m([{id:"monthly",messageText:"We notice you're using an ad-blocker. Perhaps you'll support us another way? Become a Supporter from just £5 per month",linkText:"Find out more"},{id:"annual",messageText:"We notice you're using an ad-blocker. Perhaps you'll support us another way? Become a Supporter for just £50 per a year",linkText:"Find out more"},{id:"weekly",messageText:"We notice you're using an ad-blocker. Perhaps you'll support us another way? Become a Supporter for less than £1 per week",linkText:"Find out more"},{id:"no-price",messageText:"We notice you're using an ad-blocker. Perhaps you'll support us another way?",linkText:"Become a supporter today"}]);new r("adblock-message",{pinOnHide:!1,siteMessageLinkName:"adblock message variant "+t.id,siteMessageCloseBtn:"hide"}).show(i(d,{linkHref:e+"?INTCMP=adb-mv-"+t.id,messageText:t.messageText,linkText:t.linkText,arrowWhiteRight:u("arrowWhiteRight")}))}function g(){var e=[{supporterLink:"https://membership.theguardian.com/supporter?INTCMP=ADBLOCK_BANNER_MONBIOT",quoteText:"Become a Guardian Member and support independent journalism",quoteAuthor:"George Monbiot",customCssClass:"monbiot",imageAuthor:"//i.guim.co.uk/img/static/sys-images/Guardian/Pix/contributor/2015/7/9/1436429159376/George-Monbiot-L.png?w=300&amp;q=85&amp;auto=format&amp;sharp=10&amp;s=903233b032379d7529d7337b8c26bcc9"},{supporterLink:"https://membership.theguardian.com/supporter?INTCMP=ADBLOCK_BANNER_MUIR",quoteText:"Support and become part of the Guardian",quoteAuthor:"Hugh Muir",customCssClass:"muir",imageAuthor:"//i.guim.co.uk/img/static/sys-images/Guardian/Pix/pictures/2014/3/13/1394733739000/HughMuir.png?w=300&amp;q=85&amp;auto=format&amp;sharp=10&amp;s=c1eeb35230ad2a215ec9de76b3eb69fb"},{supporterLink:"https://membership.theguardian.com/supporter?INTCMP=ADBLOCK_BANNER_TOYNBEE",quoteText:"If you read the Guardian, join the Guardian",quoteAuthor:"Polly Toynbee",customCssClass:"toynbee",imageAuthor:"//i.guim.co.uk/img/static/sys-images/Guardian/Pix/contributor/2014/6/30/1404146756739/Polly-Toynbee-L.png?w=300&amp;q=85&amp;auto=format&amp;sharp=10&amp;s=abf0ce1a1a7935e82612b330322f5fa4"},{supporterLink:"https://membership.theguardian.com/supporter?INTCMP=ADBLOCK_BANNER_MACASKILL",quoteText:"The Guardian enjoys rare freedom and independence. Support our journalism",quoteAuthor:"Ewen MacAskill",customCssClass:"macaskill",imageAuthor:"//i.guim.co.uk/img/static/sys-images/Guardian/Pix/contributor/2015/8/18/1439913873894/Ewen-MacAskill-R.png?w=300&q=85&auto=format&sharp=10&s=0ecfbc78dc606a01c0a9b04bd5ac7a82"}];new a(e[h(e.length-1)]).show()}function f(){s.showAdblockMsg()&&(p(),g())}return{init:f}}),define("common/utils/formatters",[],function(){return{integerCommas:function(e){var t,n,o,i=parseInt(e,10);if(!isNaN(i)){for(t=i.toFixed(0).split(""),o=t.length,n=t.length-1;n>=1;n--)(o-n)%3===0&&t.splice(n,0,",");return t.join("")}}}}),define("text!common/views/discussion/comment-count.html",[],function(){return'<a class="fc-trail__count fc-trail__count--commentcount" href="<%=url%>" data-link-name="Comment count"><%=icon%> <%=count%></a>\n'}),define("text!common/views/discussion/comment-count--content.html",[],function(){return'<a href="<%=url%>" data-link-name="Comment count" class="commentcount2 tone-colour">\n    <h3 class="commentcount2__heading"><%=icon%> Comments</h3>\n    <span class="commentcount2__value tone-colour"><%=count%></span>\n</a>\n'}),define("text!common/views/discussion/comment-count--content-immersive.html",[],function(){return'<a href="<%=url%>" data-link-name="Comment count" class="commentcount2 tone-colour">\n    <%=icon%><span class="commentcount__value"><%=count%></span> Comments\n</a>\n'}),define("lodash/internals/createAggregator",["./baseEach","../functions/createCallback","../objects/isArray"],function(e,t,n){function o(o){return function(i,s,a){var r={};if(s=t(s,a,3),n(i))for(var c=-1,l=i.length;++c<l;){var d=i[c];o(r,d,s(d,c,i),i)}else e(i,function(e,t,n){o(r,e,s(e,t,n),n)});return r}}return o}),define("lodash/collections/groupBy",["../internals/createAggregator"],function(e){var t=Object.prototype,n=t.hasOwnProperty,o=e(function(e,t,o){(n.call(e,o)?e[o]:e[o]=[]).push(t)});return o}),define("common/modules/discussion/comment-count",["bonzo","fastdom","qwery","common/utils/$","common/utils/ajax","common/utils/formatters","common/utils/mediator","common/utils/template","common/views/svgs","text!common/views/discussion/comment-count.html","text!common/views/discussion/comment-count--content.html","text!common/views/discussion/comment-count--content-immersive.html","lodash/collections/groupBy","lodash/collections/forEach","lodash/collections/sortBy","lodash/arrays/uniq","lodash/objects/keys","common/utils/chain"],function(e,t,n,o,i,s,a,r,c,l,d,u,m,h,p,g,f,v){function b(t){var o=n("["+C+"]",t);return m(o,function(t){return e(t).attr(C)})}function w(e){return v(e).and(f).and(g).and(p).join(",").value()}function y(e){var t=e.getElementsByTagName("a")[0];return(t?t.pathname:"")+"#comments"}function k(o,i){o.forEach(function(o){h(i[o.id],function(i){var a,l,d,u,m=e(i),h=m.attr("data-discussion-url")||y(i);("true"!==m.attr("data-discussion-closed")||0!==o.count)&&(a=m.data("commentcount-format"),u=r(A[a]||I,{url:h,icon:c("commentCount16icon",["inline-tone-fill"]),count:s.integerCommas(o.count)}),d=n(".js-item__meta",i),l=d.length?e(d):m,t.write(function(){l.append(u),m.removeAttr(C),m.removeClass("u-h")}))})}),t.write(function(){a.emit("modules:commentcount:loaded",o)})}function _(e){t.read(function(){var t=b(e||document.body),n=w(t);i({url:T+n,type:"json",method:"get",crossOrigin:!0,success:function(e){e&&e.counts&&k(e.counts,t)}})})}function S(){document.body.querySelector("[data-discussion-id]")&&_(document.body),a.on("modules:related:loaded",_)}var C="data-discussion-id",T="/discussion/comment-counts.json?shortUrls=",A={content:d,contentImmersive:u},I=l;return{init:S,getCommentCounts:_,getContentIds:w,getElementsIndexedById:b}}),define("common/modules/identity/facebook-authorizer",[],function(){function e(e){this.appId=e,this.onConnected=new t,this.onFBScriptLoaded=new t,this.onUserDataLoaded=new t,this.onNotAuthorized=new t,this.onNotLoggedIn=new t,this.cancelledLogin=new t}function t(){this.callbacks=[]}var n="facebook-jssdk";return e.DEFAULT_PERMISSIONS={scope:"email,publish_actions,publish_stream"},e.prototype.onConnected=null,e.prototype.onFBScriptLoaded=null,e.prototype.onUserDataLoaded=null,e.prototype.onNotAuthorized=null,e.prototype.onNotLoggedIn=null,e.prototype.cancelledLogin=null,e.accessToken=null,e.userId=null,e.userData=null,e.prototype.login=function(t,n){return(n||!this.accessToken&&!this.loginPending)&&(this.cancelledLogin.reset(),this.onConnected.reset(),this.loginPending=!0,this._loadFacebookAPI().then(function(n){n.login(this._handleGotLoginStatus.bind(this,!0),t||e.DEFAULT_PERMISSIONS)}.bind(this))),this.onConnected},e.prototype.getLoginStatus=function(t){return this.loginStatusPending||(this.loginStatusPending=!0,this._loadFacebookAPI().then(function(n){n.getLoginStatus(this._handleGotLoginStatus.bind(this,!1),t||e.DEFAULT_PERMISSIONS)}.bind(this))),this.onConnected},e.prototype._handleGotLoginStatus=function(e,t){switch(this.loginStatusPending=!1,this.loginPending=!1,t.status){case"connected":this.accessToken=t.authResponse.accessToken,this.userId=t.authResponse.userID,this._getUserData(),this.onConnected.resolve(FB,t.authResponse);break;case"not_authorized":this._getUserData(),this.onNotAuthorized.resolve(this);break;default:e&&this.cancelledLogin.resolve(),this.onNotLoggedIn.resolve()}},e.prototype._getUserData=function(){FB.api("/me",this._handleGotUserData.bind(this))},e.prototype._handleGotUserData=function(e){e&&!e.error&&(this.userData=e,this.onUserDataLoaded.resolve(e))},e.prototype._loadFacebookAPI=function(){return window.FB?this.onFBScriptLoaded.resolve(window.FB):document.getElementById(n)||this._requiredAlready||(this._requiredAlready=!0,this._loadFacebookScript()),this.onFBScriptLoaded},e.prototype._loadFacebookScript=function(){guardian.config.page.isPreview||require(["js!facebook.js"],this._handleScriptLoaded.bind(this))},e.prototype._handleScriptLoaded=function(){FB&&(FB.init({appId:this.appId,status:!0,cookie:!0,xfbml:!0}),this.onFBScriptLoaded.resolve(FB))},t.prototype.resolve=function(){this.args=Array.prototype.slice.apply(arguments);var e,t=this.callbacks.length;for(e=0;t>e;e++)this.callbacks[e].apply(null,this.args);this.callbacks=[]},t.prototype.then=function(e){void 0!==this.args?e.apply(null,this.args):this.callbacks.push(e)},t.prototype.reset=function(){this.args=void 0},e}),define("common/modules/navigation/profile",["bean","bonzo","fastdom","common/utils/config","common/utils/ajax","common/utils/mediator","common/modules/identity/api","lodash/objects/assign"],function(e,t,n,o,i,s,a,r){function c(e){this.opts=r(this.opts,e),this.dom.container=document.body.querySelector("."+c.CONFIG.classes.container),this.dom.content=this.dom.container.querySelector("."+c.CONFIG.classes.content),this.dom.popup=document.body.querySelector("."+c.CONFIG.classes.popup),this.dom.register=document.body.querySelector("."+c.CONFIG.classes.register),this.dom.commentActivity=document.body.querySelector("."+c.CONFIG.classes.commentActivity)}return c.CONFIG={eventName:"modules:profilenav",classes:{container:"js-profile-nav",content:"js-profile-info",popup:"js-profile-popup",register:"js-profile-register",commentActivity:"js-comment-activity",action:"brand-bar__item--action"}},c.prototype.opts={url:"https://profile.theguardian.com"},c.prototype.dom={},c.prototype.init=function(){this.setFragmentFromCookie()},c.prototype.setFragmentFromCookie=function(){var e=a.getUserFromCookie(),o=t(this.dom.container),i=t(this.dom.content),s=t(this.dom.register),r=t(this.dom.commentActivity);e&&(o.hasClass("is-signed-in")||n.write(function(){i.text(e.displayName),o.addClass("is-signed-in"),s.hide()}),r.removeClass("u-h"),r.attr("href",this.opts.url+"/user/id/"+e.id)),this.emitLoadedEvent(e)},c.prototype.emitLoadedEvent=function(e){s.emit(c.CONFIG.eventName+":loaded",e)},c.prototype.emitErrorEvent=function(){s.emit(c.CONFIG.eventName+":error")},c}),define("common/modules/identity/autosignin",["bonzo","common/utils/ajax","common/utils/config","common/utils/time","common/modules/analytics/omniture","common/modules/identity/api","common/modules/identity/facebook-authorizer","common/modules/navigation/profile","common/modules/ui/message","common/modules/ui/toggles"],function(e,t,n,o,i,a,r,c,l,d){function u(){var e=this;e.header=document.body,this.init=function(){if(a.shouldAutoSigninInUser()){var t=n.page.fbAppId,i=new r(t);i.getLoginStatus(),i.onConnected.then(function(t,n){i.onUserDataLoaded.then(function(t){t.email&&e.signin(n,t.name)})}),i.onNotLoggedIn.then(function(){var e=o.currentDate();a.setNextFbCheckTime(e.setDate(e.getDate()+1))}),i.onNotAuthorized.then(function(){var e=o.currentDate();a.setNextFbCheckTime(e.setMonth(e.getMonth()+1))})}},this.signin=function(o,a){t({url:n.page.idWebAppUrl+"/jsapi/facebook/autosignup",cache:!1,crossOrigin:!0,type:"jsonp",data:{signedRequest:o.signedRequest,accessToken:o.accessToken},success:function(t){if(e.welcome(a),"ok"===t.status){var o=new c({url:n.page.idUrl});o.init(),(new d).init(),i.populateEventProperties("Social signin auto"),s.eVar13="facebook auto",s.linkTrackVars+=",eVar13",s.tl(this,"o","Social signin auto")}}})},this.welcome=function(e){var t='<p class="site-message__message" data-test-id="facebook-auto-sign-in-banner">Welcome '+e+', you’re signed in to the Guardian using Facebook. <a data-link-name="fb auto : sign out" href="'+n.page.idUrl+'/signout"/>Sign out</a>.</p>';new l("fbauto",{important:!0}).show(t)}}return u}),define("common/modules/identity/cookierefresh",["common/modules/identity/api","common/utils/storage"],function(e,t){function n(){this.init=function(){if(t.local.isStorageAvailable()&&e.isUserLoggedIn()){var n=t.local.get(e.lastRefreshKey),o=(new Date).getTime();this.shouldRefreshCookie(n,o)&&(e.getUserFromApiWithRefreshedCookie(),t.local.set(e.lastRefreshKey,o))}},n.prototype.shouldRefreshCookie=function(e,t){return!e||t>parseInt(e,10)+2592e6}}return n}),define("common/utils/load-css-promise",["Promise"],function(e){return new e(function(e){window.guardian.css.loaded?e():window.guardian.css.onLoad=e})}),define("common/modules/ui/smartAppBanner",["fastdom","common/utils/$","common/utils/cookies","common/utils/detect","common/utils/storage","common/utils/template","common/utils/load-css-promise","common/modules/user-prefs","common/modules/ui/message"],function(e,t,n,o,i,s,a,r,c){function l(){return(o.isIOS()||o.isAndroid())&&!o.isFireFoxOSApp()}function d(){return 4>b}function u(){a.then(function(){var i=o.isIOS()?"ios":"android",a=new c(i),r=w+("mobile"===o.getBreakpoint()?"":y);a.show(s(r,f[i.toUpperCase()])),n.add(g,b+1),e.read(function(){var e=t(".site-message--ios, .site-message--android"),n=e.dim().height;0!==window.scrollY&&window.scrollTo(window.scrollX,window.scrollY+n)})})}function m(){l()&&d()&&u()}function h(){return"block"===t(".site-message--android").css("display")||"block"===t(".site-message--ios").css("display")}function p(){return t(".site-message--android").dim().height||t(".site-message--ios").dim().height}var g="GU_SMARTAPPBANNER",f={IOS:{LOGO:"http://assets.guim.co.uk/images/apps/ios-logo.png",SCREENSHOTS:"http://assets.guim.co.uk/images/apps/ios-screenshots.jpg",LINK:"https://app.adjust.com/w97upi?deep_link=gnmguardian://root?contenttype=front&source=adjust",STORE:"on the App Store"},ANDROID:{LOGO:"http://assets.guim.co.uk/images/apps/android-logo-2x.png",SCREENSHOTS:"http://assets.guim.co.uk/images/apps/ios-screenshots.jpg",LINK:"https://app.adjust.com/642i3r?deep_link=x-gu://www.theguardian.com/?source=adjust",STORE:"in Google Play"}},v=n.get(g),b=v&&!isNaN(v)?parseInt(v,10):0,w='<img src="<%=LOGO%>" class="app__logo" alt="Guardian App logo" /><div class="app__cta"><h4 class="app__heading">The Guardian app</h4><p class="app__copy">Instant alerts. Offline reading.<br/>Tailored to you.</p><p class="app__copy"><strong>FREE</strong> – <%=STORE%></p></div><a href="<%=LINK%>" class="app__link">View</a>',y='<img src="<%=SCREENSHOTS%>" class="app__screenshots" alt="screenshots" />';return{init:m,isMessageShown:h,getMessageHeight:p}}),define("common/modules/navigation/sticky",["bean","qwery","fastdom","common/utils/$","common/utils/config","common/utils/detect","common/utils/mediator","common/modules/experiments/ab","common/modules/ui/smartAppBanner","common/modules/commercial/adblock-messages","common/modules/commercial/commercial-features","lodash/collections/contains","lodash/functions/bindAll"],function(e,t,n,o,i,s,a,r,c,l,d,u,m){function h(){this.breakpoint=s.getBreakpoint(),"mobile"===this.breakpoint&&i.switches.disableStickyNavOnMobile||(this.$els={},this.config={showHeaderDepth:.5,showHeaderAppleDepth:.3,showNavigationDepth:150,distance:0,direction:"down",showNavigation:!1,thresholdMobile:400,firstLoadDepth:500,isNavigationLocked:!1},this.isMobile=u(this.breakpoint,"mobile"),this.isTablet=u(this.breakpoint,"tablet"),this.isAppleCampaign=i.page.hasBelowTopNavSlot,this.noTopBanner=!d.topBannerAd,this.isProfilePage="identity"===i.page.section,m(this,"updatePositionMobile","updatePositionAdblock","updatePositionApple","updatePosition"))}return h.prototype.init=function(){"mobile"===this.breakpoint&&i.switches.disableStickyNavOnMobile||(this.$els.header=o(".js-header"),this.$els.bannerDesktop=o(".js-top-banner-above-nav"),this.$els.bannerMobile=o(".js-top-banner-mobile"),
this.$els.bannerBelowNav=o(".js-top-banner-below-nav"),this.$els.main=o(".js-maincontent"),this.$els.navHeader=o(".js-navigation-header"),this.$els.burgerIcon=o(".js-navigation-toggle",this.$els.navHeader),this.$els.navigation=o(".js-navigation",this.$els.navHeader),this.$els.navigationGlobal=o(".js-global-navigation"),this.$els.popupSearch=o(".js-popup--search"),this.$els.window=o(window),n.read(function(){this.headerBigHeight=this.$els.navHeader.height(),this.navigationClassList=this.$els.navigation.attr("class")}.bind(this)),this.$els.window.scrollTop()>this.config.firstLoadDepth&&(this.isAppleCampaign?n.read(this.updatePositionApple):n.read(this.updatePosition)),l.showAdblockMsg()&&n.write(function(){n.read(function(){this.$els.bannerDesktop=o(".js-adblock-sticky")}.bind(this))}.bind(this)),this.updateMethod=this.getUpdateMethod(),this.isProfilePage?this.updatePositionProfile():a.on("window:throttledScroll",this[this.updateMethod]),a.on("modules:nav:open",function(){this.lockStickyNavigation()}.bind(this)),a.on("modules:nav:close",function(){this.unlockStickyNavigation()}.bind(this)),a.on("modules:search",function(){this.$els.popupSearch.hasClass("is-off")?this.unlockStickyNavigation():this.lockStickyNavigation()}.bind(this)))},h.prototype.getUpdateMethod=function(){return this.isMobile?"updatePositionMobile":l.noAdblockMsg()?"updatePositionAdblock":this.isAppleCampaign?"updatePositionApple":"updatePosition"},h.prototype.unlockStickyNavigation=function(){this.config.isNavigationLocked=!1,n.write(function(){this.$els.navigationGlobal.removeClass("navigation__expandable--sticky").attr("height","auto")}.bind(this))},h.prototype.lockStickyNavigation=function(){this.config.isNavigationLocked=!0,n.read(function(){if(this.$els.header.hasClass("l-header--is-slim")||this.isMobile||this.isTablet){var e=window.innerHeight-o(".js-mega-nav-placeholder")[0].getBoundingClientRect().top;n.write(function(){this.$els.navigationGlobal.addClass("navigation__expandable--sticky").css("height",e)}.bind(this))}}.bind(this))},h.prototype.setScrollDirection=function(e){this.config.direction=e>this.config.prevScroll?"down":"up",this.config.prevScroll=e},h.prototype.shouldShowNavigation=function(e){"up"===this.config.direction&&0===this.config.distance&&(this.config.distance=e),this.config.showNavigation=Math.abs(e-this.config.distance)>this.config.showNavigationDepth},h.prototype.showNavigation=function(o){this.shouldShowNavigation(o),"up"===this.config.direction&&this.config.showNavigation?n.write(function(){this.isTablet||this.isMobile?this.$els.navigation.removeClass("animate-down-mobile").addClass("animate-up-mobile"):this.noTopBanner?this.$els.navigation.css("display","block"):this.$els.navigation.removeClass("animate-down-desktop").addClass("animate-up-desktop")}.bind(this)):(this.config.showNavigation&&(this.config.distance=0,this.$els.navHeader.hasClass("navigation-container--expanded")&&e.fire(t(".js-navigation-toggle")[0],"click")),n.write(function(){this.isTablet||this.isMobile?this.$els.navigation.removeClass("animate-up-mobile").addClass("animate-down-mobile"):this.noTopBanner?this.$els.navigation.css("display","none"):this.$els.navigation.removeClass("animate-up-desktop").addClass("animate-down-desktop")}.bind(this)))},h.prototype.setNavigationDefault=function(){n.write(function(){this.$els.navigation.removeAttr("class"),this.$els.navigation.attr("class",this.navigationClassList)}.bind(this))},h.prototype.updatePosition=function(){var e=0,t=window.pageYOffset;this.noTopBanner||(e=this.$els.bannerDesktop.height()||128),this.setScrollDirection(t);var s=o(".site-message--ios, .site-message--android"),a=s.height();t>=this.headerBigHeight+e*this.config.showHeaderDepth+a&&!this.config.isNavigationLocked?(n.write(function(){this.$els.header.css({position:"fixed",top:0,width:"100%","z-index":"1020","margin-top":0,"backface-visibility":"hidden"}),this.$els.bannerDesktop.css({position:"absolute",width:"100%",top:this.headerBigHeight+a}),this.$els.main.css("margin-top",this.headerBigHeight+e),this.$els.header.addClass("l-header--is-slim"),this.$els.header.css({"-webkit-transform":"translateY(0%)","-ms-transform":"translateY(0%)",transform:"translateY(0%)"})}.bind(this)),this.config.isNavigationLocked||"Interactive"===i.page.contentType||this.showNavigation(t)):t>=this.headerBigHeight+a?(n.write(function(){this.$els.bannerDesktop.css({position:"absolute",width:"100%",top:this.headerBigHeight+a,"z-index":"1019"}),this.config.isNavigationLocked||this.$els.header.addClass("l-header--is-slim")}.bind(this)),this.config.isNavigationLocked||("up"===this.config.direction?n.write(function(){this.$els.header.css({"-webkit-transform":"translateY(-100%)","-ms-transform":"translateY(-100%)",transform:"translateY(-100%)"})}.bind(this)):n.write(function(){this.$els.header.css({position:"absolute","margin-top":e,"-webkit-transform":"translateY(-500%)","-ms-transform":"translateY(-500%)",transform:"translateY(-500%)","z-index":"1018"}),this.$els.main.css("margin-top",this.headerBigHeight+e)}.bind(this)))):(n.write(function(){window.scrollY>a?(this.$els.bannerDesktop.css({position:"fixed",top:0,width:"100%","z-index":"1019","backface-visibility":"hidden"}),"Interactive"!==i.page.contentType&&this.$els.header.removeClass("l-header--is-slim"),this.$els.header.css({position:"relative",width:"100%","margin-top":e,"-webkit-transform":"translateY(0%)","-ms-transform":"translateY(0%)",transform:"translateY(0%)","z-index":"1018"}),this.$els.main.css("margin-top",0),this.noTopBanner&&this.$els.navigation.css("display","block")):(this.$els.bannerDesktop.css({position:"",top:"",width:"","z-index":"","backface-visibility":""}),this.$els.header.css({position:"",width:"","margin-top":"","-webkit-transform":"","-ms-transform":"",transform:"","z-index":""}),this.$els.main.css("margin-top",""),this.noTopBanner&&this.$els.navigation.css("display",""))}.bind(this)),this.setNavigationDefault()),o(".gssb_c").length>0&&n.write(function(){o(".gssb_c").hide()})},h.prototype.updatePositionProfile=function(){var e=this.$els.header.height();n.write(function(){this.$els.header.css({position:"fixed",top:0,width:"100%","z-index":"1020","margin-top":0,"backface-visibility":"hidden"}),this.$els.main.css("padding-top",e)}.bind(this))},h.prototype.updatePositionAdblock=function(){var e=this.$els.header.height(),t=window.pageYOffset;this.setScrollDirection(t),t>=e?(n.write(function(){this.$els.header.css({position:"fixed",top:0,width:"100%","z-index":"1000","margin-top":0,"-webkit-transform":"translateY(-100%)","-ms-transform":"translateY(-100%)",transform:"translateY(-100%)","backface-visibility":"hidden"}),this.$els.header.addClass("l-header--is-slim"),this.$els.header.css({"-webkit-transform":"translateY(0%)","-ms-transform":"translateY(0%)",transform:"translateY(0%)"}),this.$els.main.css("margin-top",this.headerBigHeight)}.bind(this)),this.showNavigation(t)):(n.write(function(){this.$els.header.removeClass("l-header--is-slim"),this.$els.header.css({position:"static",width:"100%","margin-top":0,"-webkit-transform":"translateY(0%)","-ms-transform":"translateY(0%)",transform:"translateY(0%)","z-index":"998"}),this.$els.main.css("margin-top",0)}.bind(this)),this.setNavigationDefault())},h.prototype.updatePositionApple=function(){var e=this.$els.bannerBelowNav.height()||336,t=window.pageYOffset;this.setScrollDirection(t),t>=e*this.config.showHeaderAppleDepth?(n.write(function(){this.$els.header.css({position:"fixed",top:0,width:"100%","z-index":"1020","margin-top":0,"-webkit-transform":"translateY(-100%)","-ms-transform":"translateY(-100%)",transform:"translateY(-100%)","backface-visibility":"hidden"}),this.$els.bannerBelowNav.css({position:"static",top:null,width:"100%","z-index":"1019"}),this.$els.header.addClass("l-header--is-slim"),this.$els.header.css({"-webkit-transform":"translateY(0%)","-ms-transform":"translateY(0%)",transform:"translateY(0%)"})}.bind(this)),this.showNavigation(t)):(n.write(function(){this.$els.header.removeClass("l-header--is-slim"),this.$els.header.css({position:"static",width:"100%","margin-top":0,"-webkit-transform":"translateY(0%)","-ms-transform":"translateY(0%)",transform:"translateY(0%)","z-index":"1018"})}.bind(this)),this.setNavigationDefault())},h.prototype.fixedBannerMobile=function(e,t){n.write(function(){this.$els.header.css({position:"fixed",top:e,width:"100%","z-index":"1021","margin-top":0,"backface-visibility":"hidden"}),this.$els.bannerMobile.css({position:"fixed",top:this.headerBigHeight+e,width:"100%","z-index":"1019","backface-visibility":"hidden"}),this.$els.main.css("margin-top",this.headerBigHeight+t)}.bind(this))},h.prototype.updatePositionMobile=function(){var e=this.$els.bannerMobile.height(),t=window.pageYOffset,o=c.getMessageHeight();n.write(function(){this.setScrollDirection(t),c.isMessageShown()?o>t?n.write(function(){this.$els.header.css({position:"static",top:null,width:"100%","z-index":"1021","margin-top":0}),this.$els.bannerMobile.css({position:"static",top:null,width:"100%","z-index":"1019"}),this.$els.main.css("margin-top",0)}.bind(this)):t>o&&t<this.config.thresholdMobile?(n.write(function(){this.fixedBannerMobile(0,e)}.bind(this)),this.setNavigationDefault()):t>this.config.thresholdMobile&&(n.write(function(){this.$els.bannerMobile.css({position:"absolute",top:this.config.thresholdMobile+this.headerBigHeight})}.bind(this)),this.showNavigation(t)):t<this.config.thresholdMobile?(n.write(function(){this.fixedBannerMobile(0,e)}.bind(this)),this.setNavigationDefault()):(n.write(function(){this.$els.bannerMobile.css({position:"absolute",top:this.config.thresholdMobile+this.headerBigHeight})}.bind(this)),this.showNavigation(t))}.bind(this))},new h}),define("lodash/functions/throttle",["./debounce","../objects/isFunction","../objects/isObject"],function(e,t,n){function o(o,s,a){var r=!0,c=!0;if(!t(o))throw new TypeError;return a===!1?r=!1:n(a)&&(r="leading"in a?a.leading:r,c="trailing"in a?a.trailing:c),i.leading=r,i.maxWait=s,i.trailing=c,e(o,s,i)}var i={leading:!1,maxWait:0,trailing:!1};return o}),define("common/modules/navigation/search",["bean","fastdom","common/utils/$","common/utils/config","common/utils/detect","common/utils/mediator","lodash/functions/throttle"],function(e,t,n,o,i,s,a){var r=function(){var r,c,l,d,u,m=this;o.switches.googleSearch&&o.page.googleSearchUrl&&o.page.googleSearchId&&(c=o.page.googleSearchUrl+"?cx="+o.page.googleSearchId,l="identity"===o.page.section?3:10,r=a(function(){m.load()}),e.on(document,"click",".js-search-toggle",function(e){r(),m.checkResults(),m.focusSearchField(),e.preventDefault(),s.emit("modules:search")}),e.on(document,"keydown",".gsc-input",function(){t.read(function(){var e=n(".gssb_c"),o=e.css("top"),i=n(window).scrollTop();t.write(function(){e.css({top:parseInt(o,10)+i,"z-index":"1030"})})})}),e.on(document,"click",".search-results",function(e){var t=e.target;"a"===t.nodeName.toLowerCase()&&(t.target="_self")})),this.focusSearchField=function(){var e=n("input.gsc-input");e.length>0&&(e.focus(),o.switches.viewability&&"Interactive"!==o.page.contentType&&(clearInterval(u),u=setInterval(m.checkResults,250)))},this.checkResults=function(){if(n(".gsc-resultsbox-visible").length>0){var e=n(".js-popup--search");t.write(function(){e.css("height","auto"),n(".gsc-results",e).css({height:"auto","overflow-y":"visible"})}),(n(".l-header--is-slim").length>0||"mobile"===i.getBreakpoint())&&t.read(function(){var o=window.innerHeight-e[0].getBoundingClientRect().top;t.write(function(){e.css("height",o),n(".gsc-results",e).css({height:o-150,"overflow-y":"auto"})})}),clearInterval(u)}},this.load=function(){var e,n;d=document.body.querySelector(".js-search-placeholder"),window.__gcse={callback:m.focusSearchField},Array.prototype.forEach.call(document.querySelectorAll(".js-search-placeholder"),function(e){e!==d&&t.write(function(){e.innerHTML=""})}),d.innerHTML||(t.write(function(){d.innerHTML='<div class="search-box" role="search"><gcse:searchbox></gcse:searchbox></div><div class="search-results" data-link-name="search"><gcse:searchresults webSearchResultSetSize="'+l+'" linkTarget="_self"></gcse:searchresults></div>'}),e=document.createElement("script"),e.async=!0,e.src=c,n=document.getElementsByTagName("script")[0],t.write(function(){n.parentNode.insertBefore(e,n)}))},this.init=function(){}};return r}),define("common/modules/onward/more-tags",["common/utils/$","bean"],function(e,t){function n(){this.init=function(){var n=e(".js-more-tags");0!==n.length&&(n.removeClass("modern-hidden"),t.on(document.querySelector(".js-more-tags__link"),"click",function(){e(".modern-hidden-tag").removeClass("modern-hidden"),n.addClass("modern-hidden")}))}}return n}),define("common/modules/onward/tech-feedback",["bean","fastdom","common/utils/$","common/utils/config","common/utils/detect","common/modules/commercial/dfp-api","lodash/collections/reduce","lodash/objects/assign"],function(e,t,n,o,i,s,a,r){function c(e){return a(e,function(e,t,n){return e+n+": "+t+"\n"},"")}function l(e){return a(e,function(e,t,n){return e+"&"+encodeURIComponent(n)+"="+encodeURIComponent(t)},"")}function d(e){return function(t){return function(){var n=t.attr("href"),i={page:window.location,width:window.innerWidth,ads:s.getCreativeIDs().join(" "),ophanId:o.ophan.pageViewId},a=l(r(i,e));t.attr("href",n+"#"+a.substring(1))}}}function u(e){return function(t){return function(){var n=t.attr("href"),o={browser:window.navigator.userAgent,page:window.location,width:window.innerWidth,adBlock:i.adblockInUse(),devicePixelRatio:window.devicePixelRatio},s="\r\n\r\n\r\n\r\n------------------------------\r\nAdditional technical data about your request - please do not edit:\r\n\r\n"+c(r(o,e))+"\r\n\r\n";t.attr("href",n+"?body="+encodeURIComponent(s))}}}function m(t,o){var i=n(t);i.length&&e.on(i[0],"click",o(i))}function h(e){var t=e.substring(1).split("&");return a(t,function(e,t){var n=t.split("="),o={};return n[0]&&n[1]?(o[decodeURIComponent(n[0])]=decodeURIComponent(n[1]),r(e,o)):e},{})}return function(){var e=h(window.location.hash);this.getValuesFromHash=h,m(".js-tech-feedback-report",d(e)),m(".js-tech-feedback-mailto",u(e)),m(".js-userhelp-mailto",u(e)),m("[href=mailto:crosswords.beta@theguardian.com]",u(e))}}),define("common/modules/ui/accessibility-prefs",["common/utils/$","common/modules/user-prefs","lodash/collections/forEach"],function(e,t,n){function o(t){var n=t+"(100%)";e("body").css({"-webkit-filter":n,filter:n})}return function(){n(["sepia","grayscale","invert","contrast","saturate","opacity"],function(e){t.isOn(e)&&o(e)})}}),define("common/modules/ui/clickstream",["bean","common/utils/mediator","common/modules/experiments/ab","lodash/objects/merge","lodash/collections/map"],function(e,t,n,o,i){var s=function(s){s=s||{};var a=s.filter||[],r=function(e){return a.filter(function(t){return t===e})},c=function(e){var t,n,o,i;return e=e||"",t=e.match(/:\/\/(.[^\/]+)/),t&&(t=t[1],n=e.match(/^(https?:)\/\//),n=n?n[1]:void 0,o=window.location.hostname,i=window.location.protocol),0===e.indexOf("mailto:")?!1:!t||t===o&&n===i},l=function(e,t){if(!e.el)return!1;var n,i=e.el,s=i.tagName.toLowerCase(),a=i.getAttribute("data-link-name");if(a&&e.tag.unshift(a),"body"===s)return e.tag=e.tag.join(" | "),delete e.el,e.validTarget&&i.getAttribute("data-link-test")&&(e.tag=i.getAttribute("data-link-test")+" | "+e.tag),e;var d=JSON.parse(i.getAttribute("data-custom-event-properties")||"{}");return e.customEventProperties=o(d,e.customEventProperties),e.validTarget||(e.validTarget=r(s).length>0||!!t,e.validTarget&&(e.target=i,n=i.getAttribute("href"),e.samePage=n&&0===n.indexOf("#")||"button"===s||i.hasAttribute("data-is-ajax"),e.sameHost=e.samePage||c(n))),!e.linkContext&&i.getAttribute("data-link-context-path")&&(e.linkContextPath=i.getAttribute("data-link-context-path"),e.linkContextName=i.getAttribute("data-link-context-name")),e.el=i.parentNode,l(e)};return s.addListener!==!1&&e.add(document.body,"click",function(e){var o,s={el:e.target,tag:[]};s.target=e.target,s=l(s),o=n.getActiveTestsEventIsApplicableTo(s),void 0!==o&&o.length>0&&(s.tag=i(o,function(e){var t=n.getTestVariantId(e);return"AB,"+e+","+t+","+s.tag}).join(",")),t.emit("module:clickstream:click",s)}),{getClickSpec:l}};return s}),define("common/modules/ui/dropdowns",["common/utils/$","bonzo","bean"],function(e,t,n){function o(){n.on(document.body,"click",s.button,function(n){var o=t(e.ancestor(n.currentTarget,s.container.substring(1)));o.toggleClass("dropdown--active"),i(o)})}function i(n){n.each(function(n){var o=t(n).hasClass("dropdown--active");e(s.content,n).attr("aria-hidden",!o),e(s.button,n).attr("aria-expanded",o),e(s.content,n).attr("aria-expanded",o)})}var s={container:".dropdown",button:".dropdown__button",content:".dropdown__content"};return{init:o,updateAria:i}}),define("common/modules/ui/faux-block-link",["bean","bonzo","fastdom","common/utils/$"],function(e,t,n,o){var i=".u-faux-block-link__overlay",s="u-faux-block-link--hover";return function(){var t=function(e){n.write(function(){o(e.currentTarget).parent().addClass(s)})},a=function(e){n.write(function(){o(e.currentTarget).parent().removeClass(s)})};e.on(document.body,"mouseenter",i,t),e.on(document.body,"mouseleave",i,a)}}),define("common/modules/ui/cookiesBanner",["common/utils/config","common/utils/$","common/utils/cookies","common/utils/detect","common/utils/storage","common/utils/template","common/modules/user-prefs","common/modules/ui/message","common/utils/mediator"],function(e,t,n,o,i,s,a,r,c){function l(){var e=n.get("GU_geo_continent");if(e&&"EU"===e.toUpperCase()){var t="GU_EU_MSG",o=n.get(t);if(!o||"seen"!=o){var i="https://www.theguardian.com/info/cookies",s='Welcome to the Guardian. This site uses cookies, read our policy <a href="'+i+'" class="cookie-message__link">here</a>',a={important:!0},l=365,d=new r("cookies",a);return d.show(s),n.add(t,"seen",l),!0}}c.emit("modules:ui:cookiesBanner:notShown")}return{init:l}}),define("common/modules/ui/relativedates",["common/utils/$","common/utils/config","common/utils/mediator","bonzo"],function(e,t,n,o){function i(){return new Date((new Date).getTime()-k)}function s(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]}function a(e){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e]}function r(e){return 10>e?"0"+e:e}function c(e){var t=i();return e&&e.toDateString()===t.toDateString()}function l(e){var t=i();return e&&e.valueOf()>t.valueOf()-864e5}function d(e,t){var n=i();return e&&e.valueOf()>n.valueOf()-1e3*(t||0)}function u(e){var t=i(),n=i();return n.setDate(t.getDate()-1),e.toDateString()===n.toDateString()}function m(e){var t=i().valueOf()-6048e5;return e.valueOf()>=t}function h(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())}function p(e,t,n){var o,i={s:{"short":["s"],med:["s ago"],"long":[" second ago"," seconds ago"]},m:{"short":["m"],med:["m ago"],"long":[" minute ago"," minutes ago"]},h:{"short":["h"],med:["h ago"],"long":[" hour ago"," hours ago"]},d:{"short":["d"],med:["d ago"],"long":[" day ago"," days ago"]}};return i[e]?(o=i[e][t],1===n?o[0]:o[o.length-1]):""}function g(e,t){t=t||{};var n,o,r,d,g=new Date(Number(e)),v=i(),b=t.format||"short",w="short"===t.format||"med"===t.format;return h(g)?(d=parseInt((v.getTime()-g)/1e3,10),0>d?!1:t.notAfter&&d>t.notAfter?!1:55>d?d+p("s",b,d):3300>d?(n=Math.round(d/60,10),n+p("m",b,n)):c(g)||w&&l(g)?(o=Math.round(d/3600),o+p("h",b,o)):w&&m(g)?(r=Math.round(d/3600/24),r+p("d",b,r)):u(g)?"Yesterday"+f(g):432e3>d?[s(g.getDay()),g.getDate(),a(g.getMonth()),g.getFullYear()].join(" ")+(t.showTime?f(g):""):[g.getDate(),a(g.getMonth()),g.getFullYear()].join(" ")+(t.showTime?f(g):"")):!1}function f(e){return" "+e.getHours()+":"+r(e.getMinutes())}function v(){return e(".js-timestamp, .js-item__timestamp")}function b(){var t="js-locale-timestamp";e("."+t).each(function(e){var n,i=o(e),s=parseInt(i.attr("data-timestamp"),10);s&&(n=new Date(s),e.innerHTML=r(n.getHours())+":"+r(n.getMinutes()),i.removeClass(t))})}function w(e){e=e||{},v().each(function(t){var n,i=o(t),s=parseInt(i.attr("data-timestamp"),10)||i.attr("datetime"),a=new Date(s),r=g(a.getTime(),{showTime:o(i.parent()).hasClass("block-time"),format:i.attr("data-relativeformat"),notAfter:e.notAfter});r?(n=i[0].querySelector(".timestamp__text")||i[0],n.getAttribute("title")||n.setAttribute("title",o(n).text()),n.innerHTML=r):e.notAfter&&i.addClass("modern-hidden")})}function y(e){w(e),b(e)}var k=t.page&&t.page.renderTime?Math.max(0,new Date-new Date(t.page.renderTime)):0;return["related","autoupdate"].forEach(function(e){n.on("modules:"+e+":render",w)}),{makeRelativeDate:g,isWithinSeconds:d,init:y}}),define("text!common/views/breaking-news.html",[],function(){return'<div class="js-breaking-news__item breaking-news__item" data-breaking-article-id="<%=id%>">\n    <div class="breaking-news__item-content">\n        <div class="breaking-news__item-header">\n            <%=marque36icon%>\n            <em class="breaking-news__item-kicker">Breaking news</em>\n            <div class="breaking-news__item-headline"><%=headline%></div>\n        </div>\n        <div class="breaking-news__item-options">\n            <button class="js-breaking-news__item__close button button--tertiary u-faux-block-link__promote"\n                    aria-label="Dismiss"\n                    data-link-name="close button"><%=closeIcon%></button>\n        </div>\n    </div>\n    <a class="u-faux-block-link__overlay" href="/<%=id%>"></a>\n</div>\n'}),define("common/modules/onward/breaking-news",["bean","bonzo","common/utils/$","fastdom","qwery","common/utils/ajax","common/utils/config","common/utils/storage","common/utils/template","common/modules/ui/relativedates","common/modules/analytics/omniture","common/views/svgs","text!common/views/breaking-news.html","lodash/collections/forEach","lodash/objects/isArray","lodash/collections/filter","lodash/arrays/flatten","common/utils/chain","lodash/arrays/first"],function(e,t,n,o,i,s,a,r,c,l,d,u,m,h,p,g,f,v,b){function w(e,t){var n={};return h(e,function(e){n[e]=t[e]||!1}),n}var y,k,_,S,C=1200,T={sport:"sport",football:"sport"},A="/breaking-news/lite.json",I="gu.breaking-news.hidden",x=1;return function(){var M=a.page,j=r.local.get(I)||{};M&&j[M.pageId]!==!0&&s({url:A,type:"json",crossOrigin:!0}).then(function(s){var a,A=(s.collections||[]).filter(function(e){return p(e.content)&&e.content.length}).map(function(e){return e.href=(e.href||"").toLowerCase(),e}),N=(M.edition||"").toLowerCase(),L=T[M.section],D=v([A.filter(function(e){return"global"===e.href}).map(function(e){return e.content}),A.filter(function(e){return e.href===N}).map(function(e){return e.content}),A.filter(function(e){return L&&e.href===L}).map(function(e){return e.content})]).and(f).and(g,function(e){var t=e.frontPublicationDate;return t&&l.isWithinSeconds(new Date(t),C)}).value(),B=D.map(function(e){return e.id}),$=3e3;B.indexOf(M.pageId)>-1&&(j[M.pageId]=!0),r.local.set(I,w(B,j)),a=v(D).and(g,function(e){return j[e.id]!==!0}).and(b,x).value(),a.length&&(y=y||t(i(".js-breaking-news-placeholder")),_=u("marque36icon"),S=u("closeCentralIcon"),h(a,function(i){var s;i.marque36icon=_,i.closeIcon=S,s=t.create(c(m,i)),e.on(n(".js-breaking-news__item__close",s)[0],"click",function(){o.write(function(){n("[data-breaking-article-id]").hide()}),j[i.id]=!0,r.local.set(I,w(B,j))}),o.write(function(){y.append(s)}),j[i.id]===!1&&($=0)}),setTimeout(function(){var e,n="breaking news alert shown"+($?"":" 2 or more times");k=k||t(document.body),e=t(t.create(y[0])).addClass("breaking-news--spectre").removeClass("breaking-news--hidden"),o.write(function(){k.append(e)}),$||o.write(function(){y.removeClass("breaking-news--fade-in")}),o.write(function(){y.removeClass("breaking-news--hidden")}),d.trackLink(this,n)},$))})}}),define("common/modules/social/pinterest",["fastdom","bean","common/utils/$"],function(e,t,n){function o(t){t.preventDefault(),n("img:not(.gu-image):not(.responsive-img):not(.gallery2__img)").each(function(t){e.write(function(){n(t).attr("data-pin-nopin","true")})}),require(["js!https://assets.pinterest.com/js/pinmarklet.js?r="+(new Date).getTime()])}var i,s=".social__item--pinterest";return function(){i=i||n(s),i.each(function(e){t.on(e,"click",o)})}}),define("text!common/views/save-for-later/save-link.html",[],function(){return'<a class="button button--medium button--tertiary save-for-later__button js-save-for-later__button save-for-later__button--<%= isSaved ? \'saved\' : \'save\' %>"\n   data-link-name="Save | <%= position %>"\n   data-component="save-for-later"\n   href="<%= url %>">\n    <%= icon %>\n    <!-- Not logged in -->\n    <span class="save-for-later__label save-for-later__label--save">Save for later</span>\n    <span class="save-for-later__label save-for-later__label--saved">Article saved</span>\n</a>\n'}),define("text!common/views/save-for-later/save-button.html",[],function(){return"<button class=\"button button--medium button--tertiary save-for-later__button js-save-for-later__button save-for-later__button--<%= isSaved ? 'saved' : 'save' %>\"\n   data-link-name=\"<%= isSaved ? 'Unsave' : 'Save' %> | <%= position %>\"\n   data-component=\"save-for-later\"\n   <%= !isSaved ? 'data-custom-event-properties=\\'{ \"prop74\": \"' + config.page.contentType + 'Save:' + config.page.pageId + '\" }\\'' : '' %>>\n    <%= icon %>\n    <span class=\"save-for-later__label save-for-later__label--save\">Save for later</span>\n    <span class=\"save-for-later__label save-for-later__label--saved\">Article saved</span>\n</button>\n"}),define("common/modules/save-for-later",["qwery","bonzo","bean","fastdom","common/utils/$","common/utils/detect","common/utils/config","common/utils/mediator","common/utils/template","common/modules/identity/api","common/views/svgs","text!common/views/save-for-later/save-link.html","text!common/views/save-for-later/save-button.html","lodash/functions/bindAll","lodash/objects/assign","lodash/collections/forEach","lodash/collections/filter","lodash/collections/some"],function(e,t,n,o,i,s,a,r,c,l,d,u,m,h,p,g,f,v){function b(){this.classes={saveThisArticle:".js-save-for-later",saveThisVideo:".js-save-for-later-video",saveThisArticleButton:".js-save-for-later__button",onwardContainer:".js-onward",relatedContainer:".js-related",showMoreContainer:".js-show-more",itemMeta:".js-item__meta",itemSaveLink:".js-save-for-later-link",itemSaveLinkHeading:".save-for-later-link__heading",fcItemIsSaved:"fc-save-for-later--is-saved",profileDropdownLink:".brand-bar__item--saved-for-later",identityProfileItem:".js-profile-nav"},this.attributes={containerItemShortUrl:"data-loyalty-short-url",containerItemDataId:"data-id"},this.isContent=!/Network Front|Section|Tag/.test(a.page.contentType),this.userData={},h(this,"save","delete","onSaveArticle","onDeleteArticle","createSaveFaciaItemHandler","createDeleteFaciaItemHandler","signUserInToSaveArticle")}var w=d("bookmark",["rounded-icon"]),y=(a.page.shortUrl||"").replace("http://gu.com",""),k="web:"+s.getUserAgent.browser+":"+s.getBreakpoint(),_=function(e){var t=a.page.contentType.match(/^Network Front|Section$/)?"Front":"Content";return{prop74:t+"ContainerSave:"+e}};return b.prototype.init=function(){var e=l.isUserLoggedIn();if(e)l.getSavedArticles().then(function(e){var t={message:"Not found",description:"Resource not found"};if("error"===e.status&&e.errors[0].message===t.message&&e.errors[0].description===t.description){var n=(new Date).toISOString().replace(/\.[0-9]+Z/,"+00:00");this.userData={version:n,articles:[]},this.saveIntroArticle()}else this.userData=e.savedArticles;this.updateSavedCount(),this.prepareFaciaItemLinks(!0),this.isContent&&this.renderSaveButtonsInArticle()}.bind(this));else if(this.isContent){var t=c("<%= idUrl%>/save-content?INTCMP=DOTCOM_ARTICLE_SFL&returnUrl=<%= returnUrl%>&shortUrl=<%= shortUrl%>&platform=<%= platform%>",{idUrl:a.page.idUrl,returnUrl:encodeURIComponent(document.location.href),shortUrl:y,platform:k});this.renderArticleSaveButton({url:t,isSaved:!1})}},b.prototype.renderSaveButtonsInArticle=function(){this.getSavedArticle(y)?this.renderArticleSaveButton({isSaved:!0}):this.renderArticleSaveButton({isSaved:!1})},b.prototype.renderArticleSaveButton=function(o){var i=t(e(this.classes.saveThisArticle));i.each(function(e){var i=t(e);i.css("display","block");var s={icon:w,isSaved:o.isSaved,position:i.attr("data-position"),config:a};o.url?i.html(c(u,p({url:o.url},s))):(i.html(c(m,s)),n.one(i[0],"click",this.classes.saveThisArticleButton,this[o.isSaved?"deleteArticle":"saveArticle"].bind(this,a.page.pageId,y)))}.bind(this))},b.prototype.getElementsIndexedById=function(n){var o=e("["+this.attributes.containerItemShortUrl+"]",n);return g(o,function(e){return t(e).attr(this.attributes.containerItemShortUrl)}.bind(this))},b.prototype.prepareFaciaItemLinks=function(e){this.renderFaciaItemLinks(e,document.body),r.once("modules:tonal:loaded",function(){this.renderFaciaItemLinks(e,this.classes.onwardContainer)}.bind(this)),r.once("modules:onward:loaded",function(){this.renderFaciaItemLinks(e,this.classes.onwardContainer)}.bind(this)),r.once("modules:tonal:loaded",function(){this.renderFaciaItemLinks(e,this.classes.onwardContainer)}.bind(this)),r.once("modules:related:loaded",function(){this.renderFaciaItemLinks(e,this.classes.relatedContainer)}.bind(this)),r.on("modules:show-more:loaded",function(){this.renderFaciaItemLinks(e,this.classes.showMoreContainer),i(this.classes.showMoreContainer).removeClass("js-show-more")}.bind(this))},b.prototype.renderFaciaItemLinks=function(e,t){var s=this.getElementsIndexedById(t);g(s,function(t){var s=i(t),a=i(this.classes.itemSaveLink,t),r=t.getAttribute(this.attributes.containerItemShortUrl),c=t.getAttribute(this.attributes.containerItemDataId),l=e?this.getSavedArticle(r):!1;e?this[l?"createDeleteFaciaItemHandler":"createSaveFaciaItemHandler"](a[0],c,r):n.one(a[0],"click",function(e,t){this.signUserInToSaveArticle(e,t)}.bind(this,c,r)),o.write(function(){if(l)a.addClass(this.classes.fcItemIsSaved);else{var e=i(i.ancestor(a[0],"fc-item")).attr("data-id");a.attr("data-custom-event-properties",JSON.stringify(_(e)))}a.attr("data-link-name",l?"Unsave":"Save"),s.addClass("fc-item--has-metadata"),a.removeClass("is-hidden")}.bind(this))}.bind(this))},b.prototype.save=function(e,t,n){var o=(new Date).toISOString().replace(/\.[0-9]+Z/,"+00:00"),i={id:e,shortUrl:t,date:o,read:!1,platform:k};this.userData.articles.push(i),l.saveToArticles(this.userData).then(function(e){n("error"!==e.status)})},b.prototype["delete"]=function(e,t,n){this.userData.articles=f(this.userData.articles,function(e){return e.shortUrl!==t}),l.saveToArticles(this.userData).then(function(e){n("error"!==e.status)})},b.prototype.saveArticle=function(e,t){this.save(e,t,this.onSaveArticle)},b.prototype.onSaveArticle=function(e){this.renderArticleSaveButton({isSaved:e}),e&&this.updateSavedCount()},b.prototype.deleteArticle=function(e,t){this["delete"](e,t,this.onDeleteArticle)},b.prototype.onDeleteArticle=function(e){this.renderArticleSaveButton({isSaved:!e}),e&&this.updateSavedCount()},b.prototype.saveFaciaItem=function(e,t){this.save(e,t,this.onSaveFaciaItem)},b.prototype.onSaveFaciaItem=function(n,i,s,a){var r=this;a?(this.createDeleteFaciaItemHandler(n,i,s),this.updateSavedCount(),o.write(function(){t(n).addClass(r.classes.fcItemIsSaved).attr("data-link-name","Unsave").attr("data-custom-event-properties","")})):(this.createSaveFaciaItemHandler(n,i,s),o.write(function(){t(e(r.classes.itemSaveLinkHeading,n)[0]).html("Error Saving")}))},b.prototype.deleteFaciaItem=function(e,t){this.save(e,t,this.onDeleteFaciaItem)},b.prototype.onDeleteFaciaItem=function(n,s,a,r){var c=this;r?(this.createSaveFaciaItemHandler(n,s,a),this.updateSavedCount(),o.write(function(){var e=i(i.ancestor(n,"fc-item")).attr("data-id");t(n).removeClass(c.classes.fcItemIsSaved).attr("data-link-name","Save").attr("data-custom-event-properties",JSON.stringify(_(e)));
})):(this.createDeleteFaciaItemHandler(n,s,a),o.write(function(){t(e(c.classes.itemSaveLinkHeading,n)[0]).html("Error Removing")}))},b.prototype.createSaveFaciaItemHandler=function(e,t,o){n.one(e,"click",this.save.bind(this,t,o,this.onSaveFaciaItem.bind(this,e,t,o)))},b.prototype.signUserInToSaveArticle=function(e,t){var n=c("<%= idUrl%>/save-content?returnUrl=<%= returnUrl%>&shortUrl=<%= shortUrl%>&platform=<%= platform%>&articleId=<%= articleId %>&INTCMP=SFL-SO",{idUrl:a.page.idUrl,returnUrl:encodeURIComponent(document.location.href),shortUrl:t,platform:k,articleId:e});window.location=n},b.prototype.createDeleteFaciaItemHandler=function(e,t,o){n.one(e,"click",this["delete"].bind(this,t,o,this.onDeleteFaciaItem.bind(this,e,t,o)))},b.prototype.getSavedArticle=function(e){return v(this.userData.articles,function(t){return t.shortUrl.indexOf(e)>-1})},b.prototype.updateSavedCount=function(){var e=i(this.classes.profileDropdownLink),t=i(this.classes.identityProfileItem),n=this.userData.articles?this.userData.articles.length:0;n>0?(e.attr("data-saved-content-count",n),t.addClass("has-saved-articles")):(e.removeAttr("data-saved-content-count",n),t.removeClass("has-saved-articles"))},b.prototype.saveIntroArticle=function(){var e="help/insideguardian/2015/jul/21/introducing-save-for-later",t="/p/4ab7x";this.saveArticle(e,t)},b}),define("common/modules/commercial/membership-messages",["common/utils/config","common/utils/storage","common/utils/template","common/modules/ui/message","text!common/views/membership-message.html","common/views/svgs","common/modules/commercial/commercial-features","common/modules/commercial/user-features","lodash/objects/defaults"],function(e,t,n,o,i,s,a,r,c){function l(e){return a.membershipMessages&&e.minVisited<=(t.local.get("gu.alreadyVisited")||0)}function d(e,t){return h[e]+"?INTCMP="+t.campaign}function u(e,t){var s,a=c({linkHref:d(e,t)},t.data,p);return s=new o(t.code),s.hasSeen()&&(t.code+="-redisplayed",t.campaign+="_REDISPLAYED",t.data.linkHref=d(e,t)),new o(t.code,{pinOnHide:!1,siteMessageLinkName:"membership message",siteMessageCloseBtn:"hide"}).show(n(i,a))}function m(){var t=g[e.page.edition];t&&l(t)&&u(e.page.edition,t)}var h={UK:"https://membership.theguardian.com/supporter",US:"https://membership.theguardian.com/us/supporter"},p={arrowWhiteRight:s("arrowWhiteRight")},g={UK:{campaign:"MEMBERSHIP_SUPPORTER_BANNER_UK",code:"membership-message-uk",minVisited:10,data:{messageText:["Thank you for reading the Guardian.","Help keep our journalism free and independent by becoming a Supporter for just £5 a month."].join(" "),linkText:"Join"}},US:{campaign:"MEMBERSHIP_SUPPORTER_BANNER_US",code:"membership-message-us",minVisited:10,data:{messageText:"Support open, independent journalism. Become a Supporter from just £5/$8 per month",linkText:"Find out more"}}};return{init:m}}),define("text!common/views/international-message.html",[],function(){return'<p class="site-message__message" id="site-message__message">\n    You are viewing the Guardian’s international edition.\n</p>\n<ul class="site-message__actions u-unstyled">\n    <li class="site-message__actions__item">\n        <i class="i i-back"></i>\n        <a class="js-main-site-link" rel="nofollow" href="/preference/edition/uk" data-link-name="opt-out">Opt out and visit the UK edition instead</a>\n    </li>\n</ul>\n'}),define("bootstraps/identity-common",["common/utils/robust","common/modules/identity/api"],function(e,t){function n(e){t.init(e),t.isUserLoggedIn()&&(document.documentElement.className=document.documentElement.className.replace(/\bid--signed-out\b/,"id--signed-in"))}return function(){e.catchErrorsAndLog("i-css-class",n)}}),define("bootstraps/common",["fastdom","bean","bonzo","qwery","common/utils/$","common/utils/config","common/utils/cookies","common/utils/detect","common/utils/mediator","common/utils/template","common/utils/url","common/utils/robust","common/utils/storage","common/modules/analytics/foresee-survey","common/modules/analytics/livestats","common/modules/analytics/media-listener","common/modules/analytics/omniture","common/modules/analytics/register","common/modules/analytics/scrollDepth","common/modules/analytics/css-logging","common/modules/analytics/simple-metrics","common/modules/commercial/user-ad-targeting","common/modules/commercial/donot-use-adblock","common/modules/commercial/user-features","common/modules/discussion/comment-count","common/modules/experiments/ab","common/modules/identity/autosignin","common/modules/identity/cookierefresh","common/modules/navigation/navigation","common/modules/navigation/sticky","common/modules/navigation/profile","common/modules/navigation/search","common/modules/onward/history","common/modules/onward/more-tags","common/modules/onward/tech-feedback","common/modules/ui/accessibility-prefs","common/modules/ui/clickstream","common/modules/ui/dropdowns","common/modules/ui/faux-block-link","common/modules/ui/message","common/modules/ui/cookiesBanner","common/modules/ui/relativedates","common/modules/ui/smartAppBanner","common/modules/ui/tabs","common/modules/ui/toggles","common/modules/user-prefs","common/modules/onward/breaking-news","common/modules/social/pinterest","common/modules/save-for-later","common/modules/commercial/membership-messages","common/modules/email/email","text!common/views/international-message.html","bootstraps/identity-common","lodash/collections/forEach"],function(e,t,n,o,i,s,a,r,c,l,d,u,m,h,p,g,f,v,b,w,y,k,_,S,C,T,A,I,x,M,j,N,L,D,B,$,E,F,P,U,O,R,H,q,G,Y,z,W,V,K,J,Z,X,Q){var ee={initialiseTopNavItems:function(){var e,t=new N,n=document.getElementById("header");n&&s.switches.idProfileNavigation&&(e=new j({url:s.page.idUrl}),e.init()),t.init(n)},initialiseNavigation:function(){x.init()},initialiseStickyHeader:function(){!s.switches.viewability||s.page.isProd&&"Interactive"===s.page.contentType||"Crossword"===s.page.contentType||"offline-page"===s.page.pageId||M.init()},showTabs:function(){var e=new q;["modules:popular:loaded","modules:geomostpopular:ready"].forEach(function(t){c.on(t,function(t){e.init(t)})})},showToggles:function(){var e=new G;e.init(document),e.reset(),F.init()},showRelativeDates:function(){var e=R;e.init()},initClickstream:function(){new E({filter:["a","button"]})},showAdblockMessage:function(){_.init()},logLiveStats:function(){p.log()},loadAnalytics:function(){f.go(),s.switches.ophan&&require(["ophan/ng"],function(e){s.switches.scrollDepth&&(c.on("scrolldepth:data",e.record),new b({isContent:/Article|LiveBlog/.test(s.page.contentType)}))})},cleanupCookies:function(){a.cleanUp(["mmcore.pd","mmcore.srv","mmid","GU_ABFACIA","GU_FACIA","GU_ALPHA","GU_ME","at"])},updateHistory:function(){"Network Front"!==s.page.contentType&&L.logSummary(s.page),"Video"===s.page.contentType&&L.logHistory(s.page)},showHistoryInMegaNav:function(){s.switches.historyTags&&c.once("modules:nav:open",function(){L.showInMegaNav()})},initAutoSignin:function(){s.switches.facebookAutosignin&&"mobile"!==r.getBreakpoint()&&(new A).init()},idCookieRefresh:function(){s.switches.idCookieRefresh&&(new I).init()},windowEventListeners:function(){["resize","scroll","orientationchange"].forEach(function(e){t.on(window,e,c.emit.bind(c,"window:"+e))})},throttledScrollEvent:function(){var t=!1,n=function(){t||(t=!0,e.read(function(){c.emitEvent("window:throttledScroll"),t=!1}))},o=Y.get("use-idle-callback")&&"requestIdleCallback"in window?function(){window.requestIdleCallback(n)}:n;window.addEventListener("scroll",o)},checkIframe:function(){window.self!==window.top&&i("html").addClass("iframed")},runForseeSurvey:function(){s.switches.foresee&&h.load()},startRegister:function(){s.page.isSSL||v.initialise()},showMoreTagsLink:function(){(new D).init()},initDiscussion:function(){s.switches.discussion&&C.init()},testCookie:function(){var e=d.getUrlVars();e.test&&a.addSessionCookie("GU_TEST",encodeURIComponent(e.test))},adTestCookie:function(){var e=d.getUrlVars();"clear"===e.adtest?a.remove("adtest"):e.adtest&&a.add("adtest",encodeURIComponent(e.adtest),10)},initOpenOverlayOnClick:function(){var e;t.on(document.body,"click","[data-open-overlay-on-click]",function(t){var o=n(t.currentTarget).data("open-overlay-on-click");e=document.body.scrollTop,n(document.body).addClass("has-overlay"),i("#"+o).addClass("overlay--open").appendTo(document.body)}),t.on(document.body,"click",".js-overlay-close",function(t){var o=i.ancestor(t.target,"overlay");o&&n(o).removeClass("overlay--open"),n(document.body).removeClass("has-overlay"),e&&window.setTimeout(function(){document.body.scrollTop=e,e=null},1)})},loadBreakingNews:function(){s.switches.breakingNews&&"identity"!==s.page.section&&z()},runCssLogging:function(){s.switches.cssLogging&&w()},initPublicApi:function(){window.guardian.api={logCss:w}},internationalSignposting:function(){"INT"===s.page.edition&&"international"===s.page.pageId&&new U("international-with-survey-new",{pinOnHide:!0}).show(l(Z,{}))},initPinterest:function(){/Article|LiveBlog|Gallery|Video/.test(s.page.contentType)&&W()},saveForLater:function(){if(s.switches.saveForLater){var e=new V;e.init()}},showMembershipMessages:function(){K.init()},initEmail:function(){J.init()}};return{init:function(){Q(u.makeBlocks([["c-analytics",ee.loadAnalytics],["c-cookies-banner",O.init],["c-identity",X],["c-adverts",k.requestUserSegmentsFromId],["c-discussion",ee.initDiscussion],["c-test-cookie",ee.testCookie],["c-ad-cookie",ee.adTestCookie],["c-event-listeners",ee.windowEventListeners],["c-throttled-scroll-event",ee.throttledScrollEvent],["c-breaking-news",ee.loadBreakingNews],["c-block-link",P],["c-iframe",ee.checkIframe],["c-tabs",ee.showTabs],["c-top-nav",ee.initialiseTopNavItems],["c-init-nav",ee.initialiseNavigation],["c-sticky-header",ee.initialiseStickyHeader],["c-toggles",ee.showToggles],["c-dates",ee.showRelativeDates],["c-clickstream",ee.initClickstream],["c-history",ee.updateHistory],["c-sign-in",ee.initAutoSignin],["c-id-cookie-refresh",ee.idCookieRefresh],["c-history-nav",ee.showHistoryInMegaNav],["c-forsee",ee.runForseeSurvey],["c-start-register",ee.startRegister],["c-tag-links",ee.showMoreTagsLink],["c-smart-banner",H.init],["c-adblock",ee.showAdblockMessage],["c-log-stats",ee.logLiveStats],["c-cookies",ee.cleanupCookies],["c-overlay",ee.initOpenOverlayOnClick],["c-css-logging",ee.runCssLogging],["c-public-api",ee.initPublicApi],["c-simple-metrics",y],["c-tech-feedback",B],["c-media-listeners",g],["c-accessibility-prefs",$],["c-international-signposting",ee.internationalSignposting],["c-pinterest",ee.initPinterest],["c-save-for-later",ee.saveForLater],["c-show-membership-messages",ee.showMembershipMessages],["c-email",ee.initEmail],["c-user-features",S.refresh]]),function(e){e()}),window.console&&window.console.log&&!s.page.isDev&&window.console.log("##::::: ##: ########::::::: ###:::: ########:: ########:::: ##:::: ##: ####: ########:: ####: ##::: ##:: ######::\n##: ##: ##: ##.....::::::: ## ##::: ##.... ##: ##.....::::: ##:::: ##:. ##:: ##.... ##:. ##:: ###:: ##: ##... ##:\n##: ##: ##: ##::::::::::: ##:. ##:: ##:::: ##: ##:::::::::: ##:::: ##:: ##:: ##:::: ##:: ##:: ####: ##: ##:::..::\n##: ##: ##: ######:::::: ##:::. ##: ########:: ######:::::: #########:: ##:: ########::: ##:: ## ## ##: ##:: ####\n##: ##: ##: ##...::::::: #########: ##.. ##::: ##...::::::: ##.... ##:: ##:: ##.. ##:::: ##:: ##. ####: ##::: ##:\n##: ##: ##: ##:::::::::: ##.... ##: ##::. ##:: ##:::::::::: ##:::: ##:: ##:: ##::. ##::: ##:: ##:. ###: ##::: ##:\n ###. ###:: ########:::: ##:::: ##: ##:::. ##: ########:::: ##:::: ##: ####: ##:::. ##: ####: ##::. ##:. ######::\n\nEver thought about joining us?\nhttp://developers.theguardian.com/join-the-team.html")}}}),define("common/utils/page",["common/utils/$","common/utils/config","lodash/objects/assign","lodash/collections/find"],function(e,t,n,o){function i(e,t,n,o){return e?t?t(o||e):o||e:n?n():!1}function s(e,s){var a=t.referencesOfType("pa-football-team"),r=t.page.footballMatch||{};return n(r,{date:t.webPublicationDateAsUrlPart(),teams:a,isLive:t.page.isLive,pageType:o([["minbymin",t.page.isLiveBlog],["report",t.hasTone("Match reports")],["preview",t.hasSeries("Match previews")],["stats",r.id],[null,!0]],function(e){return e[1]===!0})[0]}),i(r.id||r.pageType&&2===r.teams.length,e,s,r)}function a(t,n){var o=(e(".js-football-competition").attr("data-link-name")||"").replace("keyword: football/","");return i(o,t,n)}function r(e,n){return i(t.hasSeries("Clockwatch"),e,n)}function c(e,n){return r(function(){return i(t.page.isLive,e,n)},n)}function l(e,n){return i(t.page.hasOwnProperty("footballMatch"),e,n)}function d(t,n){var o=e(".js-after-article")[0],s=o?"none"!==window.getComputedStyle(o).getPropertyValue("display"):!1;return i(s,t,n,o)}return{isMatch:s,isCompetition:a,isClockwatch:r,isLiveClockwatch:c,isFootballStatsPage:l,belowArticleVisible:d}}),define("common/modules/charts/doughnut",["common/utils/$","lodash/objects/assign"],function(e,t){function n(t){return e.create(document.createElementNS("http://www.w3.org/2000/svg",t))}function o(e){return"translate("+e+")"}var i=function(i,s){s=t({percentCutout:35,unit:"",showValues:!1},s||{});var a,r,c,l,d,u,m,h,p,g,f=s.width,v=s.height||f,b=Math.min(v/2,f/2),w=b*(s.percentCutout/100),y=i.reduce(function(e,t){return{value:e.value+t.value}}).value,k=Math.PI/2,_=2*Math.PI,S=[f/2,v/2],C={x:f/2,y:v/2},T=e.create('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="chart chart--doughnut"></svg>').attr({width:f,height:v,viewbox:"0 0 "+[f,v].join(" ")}),A=-k;return i.forEach(function(e){a=e.value/y*_,r=A+a,c=(r-A)%_>Math.PI?1:0,l={start:{x:C.x+Math.cos(A)*b,y:C.y+Math.sin(A)*b},end:{x:C.x+Math.cos(r)*b,y:C.y+Math.sin(r)*b}},d={start:{x:C.x+Math.cos(r)*w,y:C.y+Math.sin(r)*w},end:{x:C.x+Math.cos(A)*w,y:C.y+Math.sin(A)*w}},u=(w+b)/2,m=(A+r)/2,h=["M",l.start.x,l.start.y,"A",b,b,0,c,1,l.end.x,l.end.y,"L",d.start.x,d.start.y,"A",w,w,0,c,0,d.end.x,d.end.y,"Z"],p=n("g").attr("class","chart__arc").append(n("path").attr({d:h.join(" "),fill:e.color})),g=n("text").attr("class","chart__label"),s.showValues?g.append(n("tspan").attr("class","chart__label-text").text(e.label).attr({x:0,dy:"0"})).append(n("tspan").attr("class","chart__label-value").text(e.value).attr({x:0,dy:"1em"})):g.text(e.label),g.attr({transform:o([Math.cos(m)*u+C.x,Math.sin(m)*u+C.y])}).appendTo(p),p.appendTo(T),A+=e.value/y*_}),T.append(n("text").attr("class","chart__unit").text(s.unit).attr({transform:o(S),dy:"0.4em"}))};return i}),define("common/modules/charts/table-doughnut",["bonzo","common/utils/$","common/modules/charts/doughnut"],function(e,t,n){var o=function(){};return o.prototype.render=function(o){var i,s,a=o.scrollWidth||o.getAttribute("data-chart-width"),r=t("th",o),c=t("td",o).map(function(e,t){return{label:r[t].innerHTML,value:parseInt(e.getAttribute("data-chart-value"),10),color:e.getAttribute("data-chart-color")}});return e(o).addClass("u-h"),i=new n(c,{showValues:"true"===o.getAttribute("data-chart-show-values"),unit:o.getAttribute("data-chart-unit"),width:a}),s=i.attr("class"),i.attr("class",s+" "+o.getAttribute("data-chart-class")).insertAfter(o)},o}),define("text!common/views/sport/score-container.html",[],function(){return'<div class="score-container">\n    <div class="score__loading <%=loadingState%>">\n        <div class="loading__text">Fetching the scores…</div>\n        <div class="is-updating"></div>\n    </div>\n</div>'}),define("common/modules/sport/score-board",["bonzo","common/utils/detect","common/utils/$","common/utils/template","common/modules/component","text!common/views/sport/score-container.html"],function(e,t,n,o,i,s){function a(n){this.pageType=n.pageType,this.parent=n.parent,this.placeholder=e.create(o(s,{loadingState:"report"!==this.pageType?" score__loading--live":""}))[0],"report"===this.pageType?n.parent.after(this.placeholder):n.parent.addClass("u-h").before(this.placeholder),this.endpoint=n.endpoint,this.autoupdated=n.autoupdated,this.responseDataKey=n.responseDataKey,this.updateEvery=t.isBreakpoint({min:"desktop"})?30:60}return i.define(a),a.prototype.componentClass="match-summary",a.prototype.prerender=function(){var e=n(".score__loading",n(this.placeholder));e.length&&e.remove()},a.prototype.ready=function(){this.setState(this.pageType)},a.prototype.load=function(){this.fetch(this.placeholder)},a.prototype.loadFromJson=function(e){this.template=e,this.render(this.placeholder)},a.prototype.error=function(){this.placeholder.innerHTML="",this.parent.removeClass("u-h")},a}),define("bootstraps/sport",["bonzo","bean","common/utils/$","common/utils/template","common/utils/ajax","common/utils/config","common/utils/detect","common/utils/page","common/modules/charts/table-doughnut","common/modules/component","common/modules/sport/score-board","common/modules/ui/rhc"],function(e,t,n,o,i,s,a,r,c,l,d,u){function m(){var e,t,o=s.page.cricketMatch;o&&(e=new l,t=n(".js-cricket-score")[0],e.endpoint="/sport/cricket/match/"+o+".json",e.fetch(t,"summary"))}function h(){var e="";if(s.page.isLiveBlog?e="minbymin":s.hasTone("Match reports")&&(e="report"),s.page.rugbyMatch&&e){var t=n(".js-score"),i=new d({pageType:e,parent:t,autoupdated:s.page.isLive,responseDataKey:"matchSummary",endpoint:s.page.rugbyMatch+".json?page="+encodeURIComponent(s.page.pageId)});i.fetched=function(e){n(".content--liveblog").addClass("content--liveblog--rugby"),n.create(e.nav).first().each(function(e){2===n(".tabs__tab",e).length&&(n(".js-sport-tabs").empty(),n(".js-sport-tabs").append(e))});var t=e.scoreEvents;if(a.isBreakpoint({max:"mobile"})){var i=n.create(o(e.dropdown)({name:"Score breakdown",content:t}));s.page.isLiveBlog&&i.addClass("dropdown--key-events"),i.addClass("dropdown--active"),n(".js-after-article").append(i)}else{var r=n.create(t);r.addClass("hide-on-mobile"),n(".rugby-stats").remove(),n(".score-container").after(r)}n(".match-stats__container").remove(),n.create('<div class="match-stats__container">'+e.matchStat+"</div>").each(function(e){n(".js-chart",e).each(function(e){(new c).render(e)});var t=[];t[0]={name:"Match stats",importance:3,content:e,ready:!0},p(t)}),n(".js-football-table").remove(),n.create('<div class="js-football-table" data-link-name="football-table-embed">'+e.groupTable+"</div>").each(function(e){var t=[];t[0]={name:"Table",importance:3,content:e,ready:!0},p(t)})},i.load()}}function p(e,o){e=e.filter(function(e){return e});var i=0===e.filter(function(e){return e.ready===!1}).length;i&&r.belowArticleVisible(function(){var i;n(".js-after-article").append(n.create('<div class="football-extras"></div>').each(function(t){e.forEach(function(e,a){o?n.create(o).each(function(t){s.page.isLiveBlog&&n(t).addClass("dropdown--key-events"),n(".dropdown__label",t).append(e.name),n(".dropdown__content",t).append(e.content),n(".dropdown__button",t).attr("data-link-name","Show dropdown: "+e.name).each(function(e){0===a&&(i=e)})}).appendTo(t):t.appendChild(e.content)})})),i&&t.fire(i,"click")},function(){e.forEach(function(e){u.addComponent(e.content,e.importance)})})}function g(){m(),h()}return{init:g}}),define("bootstraps/enhanced",["fastdom","bean","qwery","raven","common/utils/$","common/utils/config","common/utils/detect","common/utils/mediator","common/utils/user-timing","bootstraps/common","bootstraps/sport"],function(e,t,n,o,i,s,a,r,c,l,d){var u=function(e,t){o.context({tags:{feature:e}},t.init,[])},m=function(){if(c.mark("App Begin"),u("common",l),s.page.isFront&&require(["bootstraps/facia"],function(e){u("facia",e)}),"lifeandstyle"===s.page.section&&"Sudoku"===s.page.series&&require(["bootstraps/sudoku"],function(e){u("sudoku",e)}),"Article"===s.page.contentType&&require(["bootstraps/article","bootstraps/image-content"],function(e,t){u("article",e),u("article : image-content",t)}),("Crossword"===s.page.contentType||"offline-page"===s.page.pageId)&&require(["bootstraps/crosswords"],function(e){u("crosswords",e)}),"LiveBlog"===s.page.contentType&&require(["bootstraps/liveblog","bootstraps/image-content"],function(e,t){u("liveBlog",e),u("liveBlog : image-content",t)}),(s.isMedia||"Interactive"===s.page.contentType)&&require(["bootstraps/trail"],function(e){u("media : trail",{init:e})}),(s.isMedia||n("video, audio").length)&&require(["bootstraps/media"],function(e){u("media",e)}),"Gallery"===s.page.contentType&&require(["bootstraps/gallery","bootstraps/image-content"],function(e,t){u("gallery",e),u("gallery : image-content",t)}),"ImageContent"===s.page.contentType&&require(["bootstraps/image-content","bootstraps/trail"],function(e,t){u("image-content",e),u("image-content : trail",{init:t})}),"football"===s.page.section&&require(["bootstraps/football"],function(e){u("football",e)}),"sport"===s.page.section&&u("sport",d),"identity"===s.page.section&&require(["bootstraps/profile"],function(e){u("profile",e)}),s.page.isPreferencesPage&&require(["bootstraps/preferences"],function(e){u("preferences",e)}),s.switches.offlinePage){if("https:"===window.location.protocol){var o=window.navigator;o&&o.serviceWorker&&o.serviceWorker.register("/service-worker.js")}if("offline-page"===s.page.pageId){var a=i(".js-open-crossword-btn");t.on(a[0],"click",function(){e.write(function(){i(".js-crossword-container").removeClass("is-hidden"),a.remove()})})}}"help/accessibility-help"===s.page.pageId&&require(["bootstraps/accessibility"],function(e){u("accessibility",e)}),c.mark("App End")};return{go:m}});
//# sourceMappingURL=enhanced.js.map